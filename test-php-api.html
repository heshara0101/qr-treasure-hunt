<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHP API Test Console</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        .header p { font-size: 14px; opacity: 0.9; }
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 30px;
        }
        .section {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            background: #f9f9f9;
        }
        .section h2 {
            color: #667eea;
            font-size: 18px;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .test-button {
            display: block;
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        .test-button:hover { background: #764ba2; }
        .test-button.success { background: #4caf50; }
        .test-button.error { background: #f44336; }
        .input-field {
            display: block;
            width: 100%;
            padding: 8px;
            margin: 8px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .result {
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-top: 15px;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .result.success { border-color: #4caf50; background: #f1f8e9; }
        .result.error { border-color: #f44336; background: #ffebee; }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.ok { background: #c8e6c9; color: #2e7d32; }
        .status.error { background: #ffcdd2; color: #c62828; }
        @media (max-width: 768px) {
            .content { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß PHP API Test Console</h1>
            <p>Test your PHP backend endpoints</p>
        </div>

        <div class="content">
            <!-- Authentication Tests -->
            <div class="section">
                <h2>üîê Authentication Tests</h2>
                
                <div id="authStatus" class="status" style="display:none;"></div>

                <button class="test-button" onclick="testRegister()">
                    1. Register User
                </button>

                <button class="test-button" onclick="testLogin()">
                    2. Admin Login
                </button>

                <button class="test-button" onclick="testGetUser()">
                    3. Get Current User
                </button>

                <div id="authResult" class="result"></div>
            </div>

            <!-- Events Tests -->
            <div class="section">
                <h2>üìÖ Events Tests</h2>

                <input class="input-field" type="text" id="eventTitle" placeholder="Event Title" value="My Event">
                <input class="input-field" type="text" id="eventDesc" placeholder="Description" value="Test Event">

                <button class="test-button" onclick="testCreateEvent()">
                    4. Create Event
                </button>

                <button class="test-button" onclick="testListEvents()">
                    5. List Events
                </button>

                <div id="eventResult" class="result"></div>
            </div>

            <!-- Levels Tests -->
            <div class="section">
                <h2>üèÜ Levels Tests</h2>

                <input class="input-field" type="number" id="levelEventId" placeholder="Event ID" value="1">
                <input class="input-field" type="number" id="levelNumber" placeholder="Level Number" value="1">
                <input class="input-field" type="text" id="levelTitle" placeholder="Level Title" value="Level 1">

                <button class="test-button" onclick="testAddLevel()">
                    6. Add Level
                </button>

                <div id="levelResult" class="result"></div>
            </div>

            <!-- Tasks Tests -->
            <div class="section">
                <h2>‚ùì Tasks Tests</h2>

                <input class="input-field" type="number" id="levelId" placeholder="Level ID" value="1">
                <input class="input-field" type="text" id="taskQuestion" placeholder="Question" value="What is 2+2?">
                <input class="input-field" type="text" id="correctAnswer" placeholder="Correct Answer" value="4">

                <button class="test-button" onclick="testAddTask()">
                    7. Add Task
                </button>

                <div id="taskResult" class="result"></div>
            </div>

            <!-- Progress Tests -->
            <div class="section">
                <h2>üìä Progress Tests</h2>

                <input class="input-field" type="number" id="joinEventId" placeholder="Event ID" value="1">
                <input class="input-field" type="number" id="taskId" placeholder="Task ID" value="1">

                <button class="test-button" onclick="testJoinEvent()">
                    8. Join Event
                </button>

                <button class="test-button" onclick="testSubmitAnswer()">
                    9. Submit Answer
                </button>

                <button class="test-button" onclick="testGetResults()">
                    10. Get Results
                </button>

                <div id="progressResult" class="result"></div>
            </div>

            <!-- System Tests -->
            <div class="section">
                <h2>‚öôÔ∏è System Tests</h2>

                <button class="test-button" onclick="testDatabaseConnection()">
                    Database Connection
                </button>

                <button class="test-button" onclick="testAPIEndpoints()">
                    All API Endpoints
                </button>

                <button class="test-button" onclick="clearResults()">
                    Clear All Results
                </button>

                <div id="systemResult" class="result"></div>
            </div>
        </div>
    </div>

    <script src="js/php-api.js"></script>
    <script>
        const API_URL = 'http://localhost/qr-treasure-hunt/api';

        async function testRegister() {
            const result = await api.register(
                'test' + Date.now() + '@example.com',
                'password123',
                'Test User',
                '1234567890'
            );
            showResult('authResult', result, 'Register');
        }

        async function testLogin() {
            const result = await api.login('admin@example.com', 'admin123');
            showResult('authResult', result, 'Login');
        }

        async function testGetUser() {
            const result = await api.getUser();
            showResult('authResult', result, 'Get User');
        }

        async function testCreateEvent() {
            const title = document.getElementById('eventTitle').value;
            const desc = document.getElementById('eventDesc').value;
            const result = await api.createEvent(title, desc);
            showResult('eventResult', result, 'Create Event');
        }

        async function testListEvents() {
            const result = await api.listEvents();
            showResult('eventResult', result, 'List Events');
        }

        async function testAddLevel() {
            const result = await api.addLevel(
                document.getElementById('levelEventId').value,
                document.getElementById('levelNumber').value,
                document.getElementById('levelTitle').value,
                'Level Description'
            );
            showResult('levelResult', result, 'Add Level');
        }

        async function testAddTask() {
            const result = await api.addTask(
                document.getElementById('levelId').value,
                1,
                'mcq',
                document.getElementById('taskQuestion').value,
                ['3', '4', '5'],
                document.getElementById('correctAnswer').value
            );
            showResult('taskResult', result, 'Add Task');
        }

        async function testJoinEvent() {
            const result = await api.joinEvent(document.getElementById('joinEventId').value);
            showResult('progressResult', result, 'Join Event');
        }

        async function testSubmitAnswer() {
            const result = await api.submitAnswer(
                document.getElementById('taskId').value,
                1,
                1,
                '4'
            );
            showResult('progressResult', result, 'Submit Answer');
        }

        async function testGetResults() {
            const result = await api.getResults(1);
            showResult('progressResult', result, 'Get Results');
        }

        async function testDatabaseConnection() {
            const result = await fetch(API_URL + '/auth.php?action=test');
            const data = await result.json();
            showResult('systemResult', data, 'Database Test');
        }

        async function testAPIEndpoints() {
            const endpoints = [
                'auth.php?action=login',
                'events.php?action=list',
                'progress.php?action=get-progress'
            ];
            
            let results = {};
            for (let ep of endpoints) {
                try {
                    const result = await fetch(API_URL + '/' + ep);
                    results[ep] = result.status === 200 ? '‚úÖ OK' : '‚ùå Error';
                } catch (e) {
                    results[ep] = '‚ùå ' + e.message;
                }
            }
            showResult('systemResult', results, 'Endpoints');
        }

        function clearResults() {
            document.querySelectorAll('.result').forEach(el => el.textContent = '');
        }

        function showResult(elementId, data, title) {
            const element = document.getElementById(elementId);
            element.className = 'result ' + (data.success ? 'success' : 'error');
            element.textContent = `${title}\n\n${JSON.stringify(data, null, 2)}`;
        }

        // Auto-login on load
        window.addEventListener('load', async () => {
            const result = await api.login('admin@example.com', 'admin123');
            if (result.success) {
                const status = document.getElementById('authStatus');
                status.textContent = '‚úÖ Connected to PHP Backend';
                status.className = 'status ok';
                status.style.display = 'block';
            } else {
                const status = document.getElementById('authStatus');
                status.textContent = '‚ùå Cannot connect to PHP Backend';
                status.className = 'status error';
                status.style.display = 'block';
            }
        });
    </script>
</body>
</html>
